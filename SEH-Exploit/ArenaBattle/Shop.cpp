/***
 *   File name: Shop.cpp
 *
 *  Created on: Nov 30, 2010
 */

#include "Shop.h"

Shop::Shop(UserInterface* display)
{
	this->display = display;
	itemsList.push_back("Weapons");
	itemsList.push_back("Armor");
	itemsList.push_back("Potions");
	itemsList.push_back("Exit Shop");
    createItems();
    potionCost = 35;
	shopping = true;
}

Shop::~Shop()
{
	// Blank
}

void Shop::browse(Human& human)
{
	while(shopping)
	{
		option = display->menu("Shop", itemsList);
		if (option == 1)
		{
			weaponsList.clear();
			for (unsigned int index = 0; index < weapons.size(); ++index)
			{
				weaponsList.push_back(weapons[index].getName());
			}
			option = display->menu("Weapon List", weaponsList);
			buy(human, weapons.at(--option));
		}
		else if (option == 2)
		{
			armorList.clear();
			for (unsigned int index = 0; index < armor.size(); ++index)
			{
				armorList.push_back(armor[index].getName());
			}
			option = display->menu("Armor List", armorList);
			buy(human, armor.at(--option));
		}
		else if (option == 3)
		{
		    buyPotion(human);
		}
		else
		{
			shopping = false;
		}
	}
}

void Shop::costDisplay(int cost, int gold)
{
	display->text("|_______________________\n");
    display->text("| This item costs: ");
    display->text(cost);
    display->text("\n| You have: ");
    display->text(gold);
}

void Shop::buy(Human& human, Weapon weapon)
{
	display->showAttributes(weapon);
    costDisplay(weapon.getPrice(), human.getGold());
    display->ask("\n| Would you like buy this item? [y/n]: ");
    if (strncmp("y", display->getInputBuffer(), 1) == 0)
	{
		if (weapon.getPrice() <= human.getGold())
		{
			human.setWeapon(weapon);
			human.decreaseGoldBy(weapon.getPrice());
		}
		else
		{
			display->text("You cannot afford this item\n");
		}
	}
}

void Shop::buy(Human& human, Armor armor)
{
	display->showAttributes(armor);
	costDisplay(armor.getPrice(), human.getGold());
	display->ask("\n| Would you like to buy this item? [y/n]: ");
	if (strncmp("y", display->getInputBuffer(), 1) == 0)
	{
		if (armor.getPrice() <= human.getGold())
		{
			human.setArmor(armor);
			human.decreaseGoldBy(armor.getPrice());
		}
		else
		{
			display->text("\n[!]You cannot afford this item\n");
		}
	}
}

void Shop::buyPotion(Human& human)
{
    costDisplay(potionCost, human.getGold());
    display->ask("\n| Would you like to buy a potion? [y/n]: ");
    if (strncmp("y", display->getInputBuffer(), 1) == 0)
    {
        if(human.getGold() >= potionCost)
        {
            human.setPotionCount(human.getPotionCount() + 1);
            human.decreaseGoldBy(potionCost);
        }
        else
        {
            display->text("\n[!] You're bad at math, huh?\n");
        }
    }
}

void Shop::createItems()
{
	/* WEAPONS */
	Weapon shortSword("Short Sword", 65, 20);
	shortSword.setPrice(150);
    Weapon longSword("Long Sword", 70, 30);
    longSword.setPrice(300);
	Weapon katana("Katana", 90, 20);
	katana.setPrice(325);
    Weapon battleAxe("Battle Axe", 80, 40);
    battleAxe.setPrice(400);
    Weapon broadSword("Broad Sword", 80, 50);
    broadSword.setPrice(450);
    Weapon greatSword("Great Sword", 85, 60);
    greatSword.setPrice(600);
    Weapon laserGun("Laser Gun", 300, 300);
    laserGun.setPrice(2000);

    weapons.push_back(shortSword);
    weapons.push_back(longSword);
    weapons.push_back(katana);
    weapons.push_back(battleAxe);
    weapons.push_back(broadSword);
    weapons.push_back(greatSword);
    weapons.push_back(laserGun);

    /* ARMOR */
    Armor winterCoat("Winter Coat", 15);
    winterCoat.setPrice(100);
    Armor scaleMail("Scale Mail", 25);
    scaleMail.setPrice(200);
    Armor sheild("Shield", 35);
    sheild.setPrice(350);
    Armor plateMail("Plate Mail", 50);
    plateMail.setPrice(450);
    Armor battalion("Battalion Armor", 75);
    battalion.setPrice(600);
    Armor kevlar("Kevlar", 300);
    kevlar.setPrice(2000);

    armor.push_back(winterCoat);
    armor.push_back(scaleMail);
    armor.push_back(sheild);
    armor.push_back(plateMail);
    armor.push_back(battalion);
    armor.push_back(kevlar);
}
